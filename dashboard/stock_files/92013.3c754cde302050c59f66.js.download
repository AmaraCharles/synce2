"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[92013],{781298:(e,t,i)=>{i.d(t,{AbstractFilledAreaPaneView:()=>p});var s=i(650151),n=(i(86441),i(5531),i(828473)),o=i(259332),l=i(432059),a=i(211414);var r=i(114555),d=i(181530);function h(e,t){return Array.from({length:e},((e,i)=>({timePointIndex:i+t})))}function c(e,t,i){let s,n;const o=e.length;for(let l=t;l>=0&&l<o;l+=i){const t=e[l];if(void 0===s&&void 0!==t.plot1Value&&(s=l),void 0===n&&void 0!==t.plot2Value&&(n=l),void 0!==s&&void 0!==n)return l}return null}function u(e){return 0===e.type?`${e.color}`:`${e.color1}:${e.color2}:${e.coordinate1}:${e.coordinate2}`}const _={type:0,color:""};class p{constructor(e,t,i){this._isHlineFill=!1,this._bandAKey=null,this._bandBKey=null,this._colorPlotIndex=null,this._areaRenderer=new r.AreaBackgroundRenderer,this._dataInvalidated=null,this._viewportInvalidated=!1,this._plIndex1=null,this._plIndex2=null,this._items=[],this._colorAreas=new r.CachedMap,this._generateColor=function(e=1e3){const t=o.default.Cache;o.default.Cache=a.CircularCacheBuffer.bind(a.CircularCacheBuffer,e);const i=(0,o.default)(l.generateColor,((e,t,i)=>`${e}_${t}_${i}`));return o.default.Cache=t,i}(),this._source=e,this._model=t,this._fillGaps=!!i?.fillgaps,this._fillToIntersection=!!i?.fillToIntersection}update(e){if("global-change"===e.type)return this._dataInvalidated=(0,d.mergeDataInvalidation)(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{e.sourceId===this._source.id()&&(this._dataInvalidated=(0,d.mergeDataInvalidation)(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData}))}}renderer(){return this._dataInvalidated?this._updateImplFull(this._dataInvalidated)&&(this._dataInvalidated=null,this._viewportInvalidated=!1):this._viewportInvalidated&&(this._updateImplLight(),this._viewportInvalidated=!1),this._areaRenderer}_minFirstBarIndex(){return-1/0}_priceScale(){return this._source.priceScale()}_firstValue(){return this._source.firstValue()}_plotNames(){return this._source.metaInfo().plots.map((e=>e.id))}_plotIndex1(){return null===this._plIndex1&&(this._plIndex1=this._plotNames().indexOf(this._plotAId())+1),this._plIndex1}_plotIndex2(){return null===this._plIndex2&&(this._plIndex2=this._plotNames().indexOf(this._plotBId())+1),this._plIndex2}_updateImplFull(e){if(this._areaRenderer.setData(null),this._dataInvalidated?.clearData&&(this._items=[]),!this._visible())return!1;if(null===this._priceScale())return!1;if(null===this._firstValue())return!1;const t=this._source.plots().plottableRange(),i=t.size();if(0===i)return!1;const o=this._source.offset(this._plotAId()),l=this._source.offset(this._plotBId()),a=Math.min(o,l),r=Math.max(o,l);let d=e.firstIndex;const c=i+(r-a)+1,u=this._plotIndex1(),_=this._plotIndex2();c!==this._items.length&&(void 0===d||0===this._items.length||d<this._items[0].timePointIndex+a?(d=void 0,
this._items=h(c,1e10)):this._items=this._items.concat(h(c-this._items.length,1e10+this._items.length)));const p=this._colorPlotIndex,m=this._transparency(),I=void 0===d?t.fullRangeIterator():t.rangeIterator(d,(0,s.ensureNotNull)(t.lastIndex()));let v=void 0!==d?(0,n.lowerbound)(this._items,d+a,((e,t)=>e.timePointIndex<t))-a:-a;for(const e of I){const t=e.index+o,i=e.index+l,s=this._items[v+o],n=this._items[v+l];if(s.timePointIndex=t,n.timePointIndex=i,this._isHlineFill||(s.plot1Value=e.value[u]??void 0,n.plot2Value=e.value[_]??void 0),null!==p){const t=v+a-1;if(t>=0&&t<this._items.length){const i=this._items[t];let s;s=0===p.type?{type:0,colorIndexOrRgba:e.value[p.colorIndexOrRgba+1]}:{type:1,colorIndexOrRgba1:void 0===p.colorIndexOrRgba1?void 0:e.value[p.colorIndexOrRgba1+1],colorIndexOrRgba2:void 0===p.colorIndexOrRgba2?void 0:e.value[p.colorIndexOrRgba2+1],value1:void 0===p.valueIndex1?void 0:e.value[p.valueIndex1+1],value2:void 0===p.valueIndex2?void 0:e.value[p.valueIndex2+1]};const n=i.color=this._getColorByPlotValue(s)??void 0;void 0!==n&&(1===n.type?(n.color1=n.color1&&this._generateColor(n.color1,m),n.color2=n.color2&&this._generateColor(n.color2,m)):n.color=this._generateColor(n.color,m))}}v+=1}return this._updateImplLight(),!0}_updateImplLight(){if(!this._visible())return;const e=this._priceScale();if(null===e)return;const t=this._firstValue();if(null===t)return;if(0===this._items.length)return;let i;if(this._isHlineFill){const n=this._source.properties().bands[(0,s.ensureNotNull)(this._bandAKey)],o=this._source.properties().bands[(0,s.ensureNotNull)(this._bandBKey)];i={level1:e.priceToCoordinate(n.value.value(),t),level2:e.priceToCoordinate(o.value.value(),t)}}const o=this._model.timeScale(),l=o.visibleBarsStrictRange();if(null===l)return;const a=e.priceToCoordinateFn(t),d=this._transparency(),h=this._minFirstBarIndex(),p=Math.max(h,l.firstBar()),m=(0,n.lowerbound)(this._items,p,((e,t)=>e.timePointIndex<t));if(m>=this._items.length)return;const I=Math.min(this._items.length-1,(0,n.lowerbound)(this._items,l.lastBar(),((e,t)=>e.timePointIndex<t)));let v,y;this._isHlineFill?(v=h===p?m:Math.max(0,m-1),y=Math.min(this._items.length-1,I+1)):(v=h===p?m:c(this._items,m-1,-1)??m,y=c(this._items,I+1,1)??I);const f=this._colorAreas;f.invalidateCache();let x,g=null,S=null,P=null;const b=this._commonColor();let w;1===b.type?(b.coordinate1=a(b.value1),b.coordinate2=a(b.value2),b.color1=b.color1&&this._generateColor(b.color1,d),b.color2=b.color2&&this._generateColor(b.color2,d)):b.color=this._generateColor(b.color,d);for(let e=v;e<=y;e+=1){const t=this._items[e],s=t.timePointIndex;let n,l;!this._fillGaps&&void 0!==w&&s-w>1&&(g=null),void 0!==i?(n=i.level1,l=i.level2):(n=t.plot1Coordinate=void 0===t.plot1Value?void 0:a(t.plot1Value),l=t.plot2Coordinate=void 0===t.plot2Value?void 0:a(t.plot2Value));const d=t.xCoordinate=o.indexToCoordinate(t.timePointIndex);if(t.color&&1===t.color.type&&(t.color.coordinate1=a(t.color.value1),t.color.coordinate2=a(t.color.value2)),
this._fillGaps?void 0!==n||void 0!==l:void 0!==n&&void 0!==l){const i=null!==this._colorPlotIndex?t.color||_:b;if(N=i,!(null===(C=P)||null===N?C===N:0===C.type&&0===N.type?C.color===N.color:1===C.type&&1===N.type&&C.color1===N.color1&&C.color2===N.color2&&C.coordinate1===N.coordinate1&&C.coordinate2===N.coordinate2)||null===g){if(null!==g&&(void 0!==n&&g.addPoints1Point(d,n),void 0!==l&&g.addPoints2Point(d,l)),e===y)continue;P=i;const t=u(i),s=f.get(t)??new r.AreaBackgroundItemsGroup(i);S=g,g=s.newItem()??new r.AreaBackgroundItem,s.push(g),f.set(t,s)}void 0!==n&&g.addPoints1Point(d,n),void 0!==l&&g.addPoints2Point(d,l)}else this._fillGaps||(P=null,g=null,S=null);w=s,x=t}var C,N;f.delete(u(_));const L={barSpacing:this._model.timeScale().barSpacing(),colorAreas:f};this._areaRenderer.setData(L)}}},512230:(e,t,i)=>{i.d(t,{AreaBackgroundPaneView:()=>o});var s=i(650151),n=i(781298);class o extends n.AbstractFilledAreaPaneView{constructor(e,t){super(e,t)}_plotAId(){return(0,s.ensureDefined)(this._source.metaInfo().area)[0].name}_plotBId(){return(0,s.ensureDefined)(this._source.metaInfo().area)[1].name}_commonColor(){return{type:0,color:this._source.properties().areaBackground.backgroundColor.value()}}_transparency(){return this._source.properties().areaBackground.transparency?.value()??0}_visible(){return this._source.properties().areaBackground.fillBackground.value()}_getColorByPlotValue(e){return this._commonColor()}}},181530:(e,t,i)=>{function s(e,t){if(null===e)return t;const i=e.firstIndex,s=t.firstIndex,n=e.clearData||t.clearData;return{firstIndex:n||void 0===i||void 0===s?void 0:Math.min(i,s),clearData:n}}i.d(t,{mergeDataInvalidation:()=>s})},703614:(e,t,i)=>{i.d(t,{StudyPlotPaneView:()=>A});var s=i(650151),n=i(724377),o=i(764829),l=i(750139),a=i(124829),r=i(432059),d=i(387964),h=i(199872),c=i(403862),u=i(982949),_=i(708698),p=i(810873),m=i(112377),I=i(40563),v=i(296842),y=i(86441),f=i(286436),x=i(509078),g=i(961970),S=i(638456);class P extends g.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=this._data,i=t.lineWidth,s=t.vertOffset||0,n=(0,f.interactionTolerance)().series+i,o=t.visibleItemsRange?.startItemIndex??0,l=t.visibleItemsRange?.endItemIndex??t.items.length;for(let a=o;a<l;a++){const o=t.items[a];if(new y.Point(o.center,o.y+s).subtract(e).length()+i<=n)return new x.HitTestResult(x.HitTarget.Regular)}return null}_drawImpl(e){const t=this._data,{horizontalPixelRatio:i,verticalPixelRatio:s,context:n}=e,o=Math.max(1,Math.floor(i))%2?.5:0,l=t.vertOffset||0,r=t.lineColor,d=t.lineWidth;let h="",c=!1;const u=t.visibleItemsRange?.startItemIndex??0,_=t.visibleItemsRange?.endItemIndex??t.items.length;for(let e=u;e<_;e++){const u=t.items[e],_=u.center,p=u.y+l;if((0,a.isNaN)(_)||(0,a.isNaN)(p))continue;let m,I;null!=u.style?(m=u.style.color,I=u.style.width):(m=r,I=d),(m!==h||S.isSafari)&&(h=m,c&&n.fill(),n.beginPath(),n.fillStyle=m);const v=Math.round(_*i)+o,y=Math.round(p*s)+o,f=Math.round(I*i)+o;n.moveTo(v+f,y),n.arc(v,y,f,0,2*Math.PI,!1),c=!0}c&&n.fill()}}
var b=i(559678),w=i(204652);class C extends g.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,f.interactionTolerance)().series+this._data.lineWidth/2;let i,s,n,o;for(let l=1;l<this._data.items.length;++l){i=this._data.items[l-1],s=this._data.items[l],n=i.center,o=s.center;if((0,w.distanceToSegment)(new y.Point(n,i.y),new y.Point(o,s.y),new y.Point(e.x,e.y)).distance<=t)return new x.HitTestResult(x.HitTarget.Regular)}return null}_drawImpl(e){const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s}=e;let n="",o=!1;const l=this._data.visibleItemsRange?.startItemIndex??0,r=(this._data.visibleItemsRange?.endItemIndex??this._data.items.length)-1;for(let e=l;e<=r;e++){const l=this._data.items[e];if((0,a.isNaN)(l.center)||(0,a.isNaN)(l.y))continue;const r=l.style?.color??this._data.lineColor,d=l.style?.width??this._data.lineWidth,h=Math.max(1,Math.floor(d*i)),c=Math.max(1,Math.floor(d*s));(r!==n||S.isSafari)&&(n=r,o&&t.fill(),t.beginPath(),t.fillStyle=r);let u=3*h;u%2!=h%2&&(u+=1);let _=3*c;_%2!=c%2&&(_+=1);const p=Math.round(Math.round(l.center*i)-u/2),m=Math.round(Math.round(l.y*s)-_/2),I=p+Math.floor(u/2-h/2),v=m+Math.floor(_/2-c/2);t.rect(p,v,u,c),t.rect(I,m,h,_),o=!0}o&&t.fill()}}class N extends g.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,f.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const n of this._data.items){const o=n.center,l=n.y;let a=t;n.style&&(i.has(n.style.width)?a=(0,s.ensureDefined)(i.get(n.style.width)):i.set(this._data.lineWidth,a));if((0,w.distanceToSegment)(new y.Point(o,l),new y.Point(o,this._data.histogramBase),new y.Point(e.x,e.y)).distance<=a)return new x.HitTestResult(x.HitTarget.Regular)}return null}_drawImpl(e){if(0===this._data.items.length)return;const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s}=e;t.fillStyle=this._data.lineColor;const n=Math.max(1,Math.floor(this._data.lineWidth*i)),o=n/2,l=Math.max(1,Math.floor(i)),a=Math.round(this._data.histogramBase*s)-Math.floor(l/2),r=a+l,d=this._data.visibleItemsRange?.startItemIndex??0,h=(this._data.visibleItemsRange?.endItemIndex??this._data.items.length)-1;for(let e=d;e<=h;e++){const d=this._data.items[e];let h=n,c=o;d.style?(t.fillStyle=d.style.color,h=Math.max(1,Math.floor(d.style.width*i)),c=h/2):t.fillStyle=this._data.lineColor;const u=h%2?.5:0,_=Math.round(d.center*i)+u,p=Math.round(d.y*s);let m,I;p<=a?(m=p,I=r):(m=a,I=p-Math.floor(l/2)+l),t.fillRect(Math.floor(_-c),m,h,I-m)}}}var L=i(748947),R=i(962973),B=i(828473),M=i(337827);const D=e=>{const t=(0,n.rgbToHsl)((0,n.parseRgb)(e)),i=t[0]+.05;return t[0]=i-Math.floor(i),(0,n.rgbToHexString)((0,n.hslToRgb)(t))},V=(0,h.memoize)(D),T=new Set([L.LineStudyPlotStyle.Line,L.LineStudyPlotStyle.Area,L.LineStudyPlotStyle.Circles,L.LineStudyPlotStyle.Cross,L.LineStudyPlotStyle.StepLine,L.LineStudyPlotStyle.StepLineWithDiamonds]);class A extends M.StudyPaneViewInplaceUpdatable{constructor(e,t,i,s,n=!1){super(t,i,s),this._histogramBase=null,this._lineColor="",this._lineWidth=1,
this._color1="",this._color2="",this._renderer=new u.CompositeRenderer,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._study=e,this._plotIndex=e.metaInfo().plots.findIndex((e=>e.id===s)),this._colorProvider=(0,R.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._extendStepLineToBarsEndings=n,this._isFundamental=(0,v.isFundamentalStudyMetaInfo)(e.metaInfo());const l=this._study.properties().styles[this._plotName].plottype.value();this._isStepLinePlot=l===L.LineStudyPlotStyle.StepLine||l===L.LineStudyPlotStyle.StepLineWithBreaks||l===L.LineStudyPlotStyle.StepLineWithDiamonds}items(){return this._items}renderer(){return this._makeSureRendererIsValid(),this._renderer}_getTranspValue(){const e=this._study.properties(),t=e.styles[this._plotName];let i=0;const s=this._study.metaInfo();return"Volume@tv-basicstudies"===s.id&&s.version<=46&&"transparency"in e?(i=e.transparency.value(),i=(0,a.isNumber)(i)?i:0,i):(t.transparency&&(i=t.transparency.value(),i=(0,a.isNumber)(i)?i:0),i)}_updateImplFull(e){if(this._renderer.clear(),this._dataInvalidated?.clearData&&(this._items=[]),!this._study.isPlotVisibleAt(this._plotName,1))return!1;const t=this._priceScale();if(!t||t.isEmpty())return!1;if(null===this._study.firstValue(void 0,this.isForceOverlay()))return!1;this._histogramBase=null;const i=this._study.properties().styles[this._plotName],n=i.plottype.value(),o=this._isFundamental&&this._isStepLinePlot,a=this._study.plots().plottableRange(o);if(0===a.size())return!1;const h=this._study.offset(this._plotName),c=T.has(n),u=this._preallocateItems(a,((e,t)=>({y:NaN,left:NaN,center:NaN,right:NaN,origPrices:{price:t??NaN,timePointIndex:e+h},timePointIndex:e+h})));let _=NaN,p=NaN;const m=new Map,v=(e,t)=>{let i=m.get(e);void 0===i&&(i=new Map,m.set(e,i));let s=i.get(t);if(void 0===s){const n=!this._plotName||"vol"!==this._plotName;s=(0,r.generateColor)(e,t,n),i.set(t,s)}return s},y=(0,I.createEmptyStyle)(),f=(0,l.clamp)(this._getTranspValue(),0,100),x=this._model.timeScale().visibleBarsStrictRange();if(null===x)return!1;const{startBar:g,endBar:S}=this._calculateStartEnd(x);if(null===g||null===S||0===this._items.length)return!1;const P=u??(0,s.ensureNotNull)(a.firstIndex()),b=(0,s.ensureNotNull)(a.lastIndex())+1,w=a.rangeIterator(P,b);let C,N=(0,B.lowerbound)(this._items,P+h,((e,t)=>e.timePointIndex<t));for(const e of w){let t=e.index;const s=e.value;t+=h,t=Math.floor(t);let n=s[this._plotIndex+1];const o=null==n;if(n=o?NaN:n,c&&o){p=n,_=t,N++;continue}const l=this._items[N];l.valIsNotSameAsPrev=n!==p||t-1!==_;if(this._colorProvider.isColorDefined()&&(l.style={color:v(i.color.value(),100),width:i.linewidth.value(),style:i.linestyle.value()},null!=n)){const e=this._colorProvider.getPlotPointStyle(s,y),t=e.colors[0];void 0!==t&&(l.style.color=(0,r.isHexColor)(t)?v(t,f):t),l.style.width=e.lineWidth??l.style.width,l.style.style=e.lineStyle??l.style.style}!c&&!isNaN(_)&&_!==t-1&&N>0&&(this._items[N].breakBefore=!0),p=n,_=t,N++,C=l}if(C&&this._isFundamental&&this._isStepLinePlot){
const e=this._model.mainSeries().data().bars().lastIndex(),t=C;if(null!==e&&e>t.timePointIndex){const i=(0,d.deepCopy)(t);i.timePointIndex=e,i.valIsNotSameAsPrev=!1,this._items.length>N?this._items[N]=i:this._items.push(i)}}return this._updateImplLight(),!0}_correctVisibleItemIndexes(e,t){const i=super._correctVisibleItemIndexes(e,t);return this._isFundamental&&this._isStepLinePlot&&i.endItemIndex===this._items.length-1&&(i.endItemIndex+=1),i}_updateRenderer(e,t){this._renderer.clear();const i=this._study.properties().styles.childs()[this._plotName].childs(),n=this._study.metaInfo().styles?.[this._plotName],o=(0,l.clamp)(this._getTranspValue(),0,100);this._lineColor=(0,r.generateColor)(i.color.value(),o),this._lineWidth=i.linewidth.value();let h=i.color.value();const u=this._colorProvider.getDefaultPlotPointStyle();u&&(h=u.colors[0]||h,this._lineWidth=u.lineWidth??this._lineWidth,this._lineColor=h?(0,r.generateColor)(h,o):this._lineColor),this._color2=(0,r.generateColor)(h,o);const I=this._study.metaInfo().isRGB?D(h):V(h);this._color1=(0,r.generateColor)(I,o);const v=this._histogramBase?this._histogramBase:(0,s.ensureNotNull)(this._priceScale()).height(),y=i.plottype.value(),f={barSpacing:this._model.timeScale().barSpacing(),items:this._items,histogramBase:v,lineIndex:0,lineStyle:i.linestyle.value(),lineColor:this._lineColor,lineWidth:(0,a.isNumber)(this._lineWidth)?this._lineWidth:1,color1:this._color1,color2:this._color2,bottom:v,visibleItemsRange:{startItemIndex:e,endItemIndex:t},simpleMode:this._colorProvider.singleColor(),skipHoles:[L.LineStudyPlotStyle.Line,L.LineStudyPlotStyle.Area,L.LineStudyPlotStyle.Cross,L.LineStudyPlotStyle.Circles,L.LineStudyPlotStyle.StepLine,L.LineStudyPlotStyle.StepLineWithDiamonds].includes(y)},x=this._renderer,g=Boolean(n?.joinPoints);switch(y){case L.LineStudyPlotStyle.Line:case L.LineStudyPlotStyle.LineWithBreaks:x.append(new _.PaneRendererLine(f));break;case L.LineStudyPlotStyle.Area:case L.LineStudyPlotStyle.AreaWithBreaks:x.append(new c.PaneRendererArea(f));break;case L.LineStudyPlotStyle.Histogram:x.append(new N(f));break;case L.LineStudyPlotStyle.Columns:x.append(new b.PaneRendererColumns(f));break;case L.LineStudyPlotStyle.Cross:x.append(new C(f)),g&&x.append(new _.PaneRendererLine({...(0,d.deepCopy)(f),lineWidth:1,forceLineWidth:!0}));break;case L.LineStudyPlotStyle.Circles:x.append(new P(f)),g&&x.append(new _.PaneRendererLine({...(0,d.deepCopy)(f),lineWidth:1,ignorePaletteLineWidth:!0}));break;case L.LineStudyPlotStyle.StepLine:case L.LineStudyPlotStyle.StepLineWithBreaks:case L.LineStudyPlotStyle.StepLineWithDiamonds:{const e=new p.PaneRendererStepLine;e.setData({...f,decoration:i.plottype.value()===L.LineStudyPlotStyle.StepLineWithDiamonds?p.StepLineDecoration.Diamonds:p.StepLineDecoration.None,extendToBarsEndings:this._extendStepLineToBarsEndings}),x.append(e);break}default:x.append(new _.PaneRendererLine(f))}this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&x.append(new m.SelectionRenderer(this._selectionData))}
_updateAdditionalPrices(e,t){const i=this._study.metaInfo().styles?.[this._plotName];void 0!==i?.histogramBase&&(this._histogramBase=e.priceToCoordinate(i.histogramBase,t))}}},249121:(e,t,i)=>{i.d(t,{StudyForceOverlayPlotView:()=>s});class s{constructor(e,t,i){this._series=e,this._model=t,this._plotName=i}isForceOverlay(){return!!this._study.metaInfo().isPlotForceOverlay(this._plotName)}_priceScale(){return this.isForceOverlay()?this._model.mainSeries().priceScale():this._study.priceScale()}}},337827:(e,t,i)=>{i.d(t,{StudyPaneViewInplaceUpdatable:()=>c});var s=i(650151),n=i(86441),o=i(181530),l=i(518439),a=i(828473),r=i(836687),d=i(509078),h=i(249121);class c extends h.StudyForceOverlayPlotView{constructor(e,t,i){super(e,t,i),this._selectionData=null,this._dataInvalidated=null,this._viewportInvalidated=!1,this._items=[],this._selectionIndexer=new r.SelectionIndexes(t.timeScale())}update(e){if("global-change"===e.type)return this._dataInvalidated=(0,o.mergeDataInvalidation)(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{if((e.sourceId===this._study.id()||this._dependsOnSeriesData()&&e.sourceId===this._model.mainSeries().id())&&!e.nonSeriesOnly){const t=(0,o.mergeDataInvalidation)(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData});this._dataInvalidated=t}}}_dependsOnSeriesData(){return!1}_makeSureRendererIsValid(){this._dataInvalidated?this._updateImplFull(this._viewportInvalidated)&&(this._dataInvalidated=null):this._viewportInvalidated&&this._updateImplLight(),this._viewportInvalidated=!1}_preallocateItems(e,t){const i=e.size(),n=this._dataInvalidated?.firstIndex;if(0===i)return n;const o=this._study.offset(this._plotName);if(i!==this._items.length){const i=void 0!==n?n+o:void 0;if(void 0===i||0===this._items.length||i<(0,s.ensureDefined)(this._items[0].timePointIndex))return this._items=[],e.each(((e,i)=>{const s=i[this._plotIndex+1];return this._items.push(t(e,s)),!1})),this._items.length?(0,s.ensureDefined)(this._items[0].timePointIndex)-o:void 0;{const i=(0,s.ensureDefined)(n),l=o>=0?0:o,r=o>=0?o:0;let d=(0,a.lowerbound)(this._items,i+l,((e,t)=>e.timePointIndex<t));const h=(0,s.ensureNotNull)(e.lastIndex()),c=e.rangeIterator(i-r,h);for(const e of c)if(void 0!==d&&this._items[d]?.timePointIndex===e.index+o)d=this._updateItem(e,d);else{const i=e.value[this._plotIndex+1];this._items.push(t(e.index,i))}}}else if(void 0!==n){const t=o>=0?0:o,i=o>=0?o:0;let l=(0,a.lowerbound)(this._items,n+t,((e,t)=>e.timePointIndex<t));const r=(0,s.ensureNotNull)(e.lastIndex())+1,d=e.rangeIterator(n-i,r);for(const e of d)l=this._updateItem(e,l)}return n}_updateItem(e,t){const i=this._getValueForUpdating(e);return this._items[t].origPrices.price=i??NaN,t+1}_getValueForUpdating(e){return e.value[this._plotIndex+1]}_calculateStartEnd(e){const t=this._study.offset(this._plotName);let i=e.firstBar()-Math.abs(t)-1,n=e.lastBar()+Math.abs(t)+1;const o=this._study.getMinFirstBarIndexForPlot(this._plotName)+t;if(o>n+1)return{
startBar:null,endBar:null};let a=this._study.plots();a=a.range(o,(0,s.ensureNotNull)(a.lastIndex())),i=Math.max(i,o),n=Math.max(n,o);const r=a.search(i,l.PlotRowSearchMode.NearestLeft,this._plotIndex+1),d=a.search(n,l.PlotRowSearchMode.NearestRight,this._plotIndex+1);return null!==r&&(i=r.index),null!==d&&(n=d.index),i=Math.max(o,i),{startBar:i,endBar:n}}_updateImplLight(){const e=this._study.firstValue(void 0,this.isForceOverlay());if(null===e)return this._selectionData=null,void this._updateRenderer(0,-1);const t=this._priceScale();if(null===t||t.isEmpty())return this._selectionData=null,void this._updateRenderer(0,-1);const i=this._model.timeScale().visibleBarsStrictRange();if(null===i)return this._selectionData=null,void this._updateRenderer(0,-1);const{startBar:s,endBar:n}=this._calculateStartEnd(i);if(null===s||null===n||0===this._items.length)return this._selectionData=null,void this._updateRenderer(0,-1);const{startItemIndex:o,endItemIndex:l}=this._correctVisibleItemIndexes(Math.max(0,(0,a.lowerbound)(this._items,s,((e,t)=>e.timePointIndex<t))),Math.min(this._items.length,(0,a.upperbound)(this._items,n,((e,t)=>e<t.timePointIndex))));if(o>=l)return this._selectionData=null,void this._updateRenderer(0,-1);this._convertItemsToCoordinates(t,e,o,l),this._createSelection(e),this._updateRenderer(o,l)}_correctVisibleItemIndexes(e,t){return{startItemIndex:e,endItemIndex:t}}_convertItemsToCoordinates(e,t,i,s){this._convertItemsToCoordinatesImpl(e,t,i,s)}_convertItemsToCoordinatesImpl(e,t,i,s){for(let e=i;e<s;e++){const t=this._items[e];t.y=t.origPrices.price}e.pointsArrayToCoordinates(this._items,t,{startItemIndex:i,endItemIndex:s}),this._model.timeScale().fillBarBorders(this._items,{startItemIndex:i,endItemIndex:s},!0),this._updateAdditionalPrices(e,t)}_updateAdditionalPrices(e,t){}_createSelection(e){const t=this._priceScale();if(null!==t)if(this._model.selection().isSelected(this._study)){const i=this._selectionIndexer.indexes(),o=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:d.HitTarget.Regular,barSpacing:this._model.timeScale().barSpacing()};const l=this._study.offset(this._plotName);for(let s=0;s<i.length;s++){let a=i[s];const r=this._study.plots().valueAt(a);if(a+=l,null===r)continue;const d=r[this._plotIndex+1];if(null==d)continue;const h=this._model.timeScale().indexToCoordinate(Math.floor(a)),c=t.priceToCoordinate(d,e);this._selectionData.points.push({point:new n.Point(h,c)}),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(c/o))}}else this._selectionIndexer.clear()}}},125624:(e,t,i)=>{i.d(t,{StudyPriceAxisView:()=>l});var s=i(650151),n=i(347808),o=i(432059);class l extends n.PriceAxisView{constructor(e,t){super(),this._model=e.model(),this._source=e,this._data=t,this._isForceOverlay=!!this._source.metaInfo().isPlotForceOverlay(this._data.plotIndex)}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1
;const n=this._source.model(),l=this._isForceOverlay?n.mainSeries().priceScale():this._source.priceScale();if(null===l)return;if(!n.isPriceScaleVisible(l))return;const a=this._source.lastValueData(this._data.plotIndex,!1);if(a.noData)return;const r=n.timeScale().visibleBarsStrictRange(),d=n.mainSeries().bars().lastIndex();if(null!==r&&null!==d){if(d<=r.lastBar()){i.background=(0,o.resetTransparency)(a.color);let s=a.color;"transparent"===s&&(s=this._model.properties().childs().scalesProperties.childs().backgroundColor.value()),i.textColor=this.generateTextColor(s),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1}else{const l=n.backgroundColorAtYPercentFromTop(a.coordinate/(0,s.ensureNotNull)(n.paneForSource(this._source)).height());i.background=l,i.textColor=(0,o.resetTransparency)(a.color),i.borderColor=(0,o.resetTransparency)(i.textColor),e.borderVisible=!0,t.borderVisible=!0}i.coordinate=a.coordinate,i.floatCoordinate=a.floatCoordinate,this._showAxisLabel()&&(e.text=a.text,e.visible=!0),this._updatePaneRendererData(t)}}_showPaneLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyPlotLabels.value()||e.showFundamentalNameLabel.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._source.priceLabelText(this._data.plotIndex),e.visible=!0)}}}}]);