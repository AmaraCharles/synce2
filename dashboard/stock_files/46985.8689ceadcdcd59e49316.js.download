(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[46985],{850775:(t,e,s)=>{"use strict";s.d(e,{mediaState:()=>l});var i=s(685459),o=s.n(i),r=s(411963),n=s(207678),a=s(76107);class h extends(o()){constructor(){super(),this.width=0,this.height=0,this.device=null,this.breakpoints=n.breakpoints,this._checkDevice(),window.addEventListener("resize",this._checkDevice),Object.entries(n.breakpoints).sort((([t,e],[s,i])=>e-i)).forEach((([t,e],s,i)=>{let o;if(0!==s){const[,t]=i[s-1];o=t+1}else o=0;const r=(0,a.matchMediaMinMax)(o,e);r.matches&&this._setNewDevice(t),r.addEventListener("change",(e=>{e.matches&&(this._checkDevice(),this._setNewDevice(t))}))})),(0,r.whenDocumentReady)(this._checkDevice.bind(this)),this.isPhoneSizeDevice.bind(this)}isPhoneSizeDevice(){return"phone"===this.device||"phone-vertical"===this.device}_checkDevice(){this.width=window.innerWidth,this.height=window.innerHeight}_setNewDevice(t){const e=this.device;this.device=t,this.trigger("changeDevice",[t,e])}}const l=new h},242238:(t,e,s)=>{"use strict";s.d(e,{ChartSession:()=>r});var i=s(942634),o=s(607016);class r extends o.Session{constructor(t,e=!1){super(t,"cs",!1),this._sessionDisabled=!1,this._handler=null,this._criticalError=new i.Delegate,this._symbolResolveMap=new Map,this._lastSymbolResolveInfoMap=new Map,this._disableStatistics=e}destroy(){this._criticalError.destroy(),this._handler=null,this._symbolResolveMap.clear(),super.destroy()}switchTimezone(t){return this._getChartApi().switchTimezone(this.sessionId(),t)}defaultResolutions(){return this._getChartApi().defaultResolutions()}availableCurrencies(){return this._getChartApi().availableCurrencies()}availableUnits(){return this._getChartApi().availableUnits()}availablePriceSources(t){return this._getChartApi().availablePriceSources(t)}resolveSymbol(t,e,s){if(this._symbolResolveMap.has(e)){const[t,i]=this._symbolResolveMap.get(e);return Array.isArray(i)?i.push(s):i.then(s),t}{const i=[s];return this._getChartApi().resolveSymbol(this.sessionId(),t,e,(s=>{if("symbol_error"===s.method)this._symbolResolveMap.delete(e);else{this._symbolResolveMap.set(e,[t,Promise.resolve(s)]);const[,i]=s.params,o={pro_name:i.pro_name,ticker:i.ticker};this._lastSymbolResolveInfoMap.set(e,o),o.pro_name&&this._lastSymbolResolveInfoMap.set(o.pro_name,o),i.full_name&&this._lastSymbolResolveInfoMap.set(i.full_name,o),o.ticker&&this._lastSymbolResolveInfoMap.set(o.ticker,o)}i.forEach((t=>t(s)))})),this._symbolResolveMap.set(e,[t,i]),t}}requestFirstBarTime(t,e,s){return this._getChartApi().requestFirstBarTime(this.sessionId(),t,e,s)}lastSymbolResolveInfo(t){return this._lastSymbolResolveInfoMap.get(t)??null}createSeries(t,e,s,i,o,r,n){return this._getChartApi().createSeries(this.sessionId(),t,e,s,i,o,r,n)}modifySeries(t,e,s,i,o,r,n){return this._getChartApi().modifySeries(this.sessionId(),t,e,s,i,o,r,n)}removeSeries(t){return!!this.isConnected().value()&&this._getChartApi().removeSeries(this.sessionId(),t)}requestMoreData(t,e,s){
return"number"==typeof t?this._getChartApi().requestMoreData(this.sessionId(),t):this._getChartApi().requestMoreData(this.sessionId(),t,e,s)}requestMoreTickmarks(t,e,s){return this._getChartApi().requestMoreTickmarks(this.sessionId(),t,e,s)}setFutureTickmarksMode(t){return this._getChartApi().setFutureTickmarksMode(this.sessionId(),t)}canCreateStudy(t,e){return this._getChartApi().canCreateStudy(this.sessionId(),t,e)}getStudyCounter(){return this._getChartApi().getStudyCounter(this.sessionId())}getFundamentalCounter(){return this._getChartApi().getFundamentalCounter(this.sessionId())}createStudy(t,e,s,i,o,r,n){return this._getChartApi().createStudy(this.sessionId(),t,e,s,i,o,r,n)}modifyStudy(t,e,s,i,o){return this._getChartApi().modifyStudy(this.sessionId(),t,e,s,i,o)}notifyStudy(t,e,s){return this._getChartApi().notifyStudy(this.sessionId(),t,e,s)}removeStudy(t){return this._getChartApi().removeStudy(this.sessionId(),t)}createPointset(t,e,s,i,o,r){return this._getChartApi().createPointset(this.sessionId(),t,e,s,i,o,r)}modifyPointset(t,e,s,i){return this._getChartApi().modifyPointset(this.sessionId(),t,e,s,i)}removePointset(t){return this._getChartApi().removePointset(this.sessionId(),t)}setVisibleTimeRange(t,e,s,i,o,r){0}criticalError(){return this._criticalError}connect(t=null){null!==t&&(this._handler=t),this._symbolResolveMap.clear(),super.connect()}setHandler(t){this._handler=t}connected(){return this.isConnected().value()&&!this._sessionDisabled}disable(){this._sessionDisabled=!0}chartApi(){return this._getChartApi()}_sendCreateSession(){Object.keys(this).forEach((t=>{/^(s|st|symbol_)\d+$/.test(t)&&delete this[t]})),this._getChartApi().chartCreateSession(this.sessionId(),this._disableStatistics)}_sendRemoveSession(){this._getChartApi().chartDeleteSession(this.sessionId())}_onMessage(t){this._handler&&this._handler(t)}_onCriticalError(t,e){this._criticalError.fire(t,e),super._onCriticalError(t,e)}}},601526:(t,e,s)=>{"use strict";s.d(e,{parseTzOffset:()=>o});var i=s(870045);function o(t,e=Date.now()){const s=(0,i.get_timezone)(t).offset_utc(e);let o="";const r=s/1e3/60/60;r%1&&(o=":"+Math.round(Math.abs(r%1*60)).toString().padStart(2,"0"));let n="";return n=r>0?"+"+(r-r%1)+o:0===r?"":String(r-r%1+o),{offset:s,string:"UTC"+n}}},558150:(t,e,s)=>{"use strict";s.d(e,{clientSnapshot:()=>M,widgetClientSnapshot:()=>A});var i=s(871934),o=s(650151),r=s(86441),n=s(724377),a=s(61499),h=s(828473),l=s(631088),d=s(511275),c=s(694852),u=s(518594),_=s(287489),m=(s(764829),s(776351));const g=Boolean(window.initData?.logo?.no_powered_by);function p(t,e=null,s=null){let i={};if("number"==typeof t)return{relativePositions:{[t]:{l:e,t:s}},nextElementLeft:t,nextElementTop:t};const[o,...r]=t;if("v"===o){let t=null;for(const o of r){const r=p(o,e,s);i={...i,...r.relativePositions},s=r.nextElementTop,t=r.nextElementLeft}e=t}if("h"===o){let t=null;for(const o of r){const r=p(o,e,s);i={...i,...r.relativePositions},e=r.nextElementLeft,t=r.nextElementTop}s=t}return{relativePositions:i,nextElementTop:s,nextElementLeft:e}}const f=function(t){
const e={};for(const s of Object.keys(t)){const i=p(t[s]).relativePositions;e[s]=i}return e}(_);function v(t,e,s,i){let o=Math.round(10*i),r=Math.round(10*i);const n=s[t];if(null!==n.l){const t=v(n.l,e,s,i);o=t.x+t.width+Math.round(5*i)}if(null!==n.t){const t=v(n.t,e,s,i);r=t.y+t.height+Math.round(5*i)}const a=e[t];return{x:o,y:r,width:a.width,height:a.height}}function S(t,e,s){const i=(new DOMParser).parseFromString(m,"image/svg+xml");i?.firstElementChild?.setAttribute("color",s);const o=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(i)],{type:"image/svg+xml"}));return new Promise((s=>{const i=new Image;i.width=t,i.height=e,i.onload=()=>{s({image:i,width:t,height:e})},i.src=o}))}function b(t,e,s,i,o){t.save(),t.drawImage(i.image,e,s,i.width,i.height),t.textBaseline="bottom";const r=(e+i.width)/o+3,n=(s+i.height)/o;(0,l.drawScaled)(t,o,o,(()=>{t.fillText("TradingView",r,n)})),t.restore()}function y(t,e,s,i){return(0,l.drawScaled)(t,i,i,(()=>{t.fillText(s,e.x/i,e.y/i)})),t.measureText(s).width*i}function x(t,e,s,i,o,n){const a=o.map((t=>t.text)).join("");let l=s.x;const d=function(t,e,s,i){if(t.measureText(e).width*i<=s)return{text:e,elided:!1};const o=t.measureText("...").width*i,r=[];for(let t=0;t<e.length;++t)r.push(t);const n=(0,h.upperbound)(r,s,((r,n)=>t.measureText(e.slice(0,n+1)).width*i+o>s));return{text:(e=e.slice(0,n)).trim(),elided:!0}}(t,a,i-l,e);if(d.elided&&!n)return null;const c=[];let u=0;for(const t of o){if(u+t.text.length>d.text.length)break;c.push(t.text),u+=t.text.length}const _=c.join("").trim().length;u=0;for(const i of o){if(u+i.text.length>_)break;i.color&&(t.save(),t.fillStyle=i.color),l+=y(t,new r.Point(l,s.y),i.text,e),i.color&&t.restore(),u+=i.text.length}return d.elided&&(l+=y(t,new r.Point(l,s.y),"...",e)),l}function C(t){return t.map((t=>({...t,title:""})))}function w(t,e){const s=[{text:t.trim()}];for(const t of e)t.visible&&(""!==s[s.length-1].text&&s.push({text:"  "}),t.title&&s.push({text:t.title}),s.push({text:t.value,color:t.color}));return s}class I{constructor(t,e){this._logoTextColor=null,this._snapshotData=t,e=e||{},this._options={backgroundColor:u.themes[t.theme].getThemedColor("color-bg-primary"),borderColor:u.themes[t.theme].getThemedColor("color-border"),font:d.CHART_FONT_FAMILY,fontSize:12,legendMode:"vertical",hideResolution:!1,hideStudiesFromLegend:!1,showHeaderPublishedBy:!1,showHeaderMainSymbol:!1,...e};const s=f[t.layout],o=t.charts.map((t=>function(t){const e=t.panes[0],s=e.canvas.width+e.leftAxis.canvas.width+e.rightAxis.canvas.width;let o=0;for(const e of t.panes)o+=e.canvas.height;return void 0!==t.timeAxis&&0!==t.timeAxis.contentHeight&&(o+=t.timeAxis.canvas.height),(0,i.size)({width:s,height:o})}(t)));if(this._pixelRatio=t.hidpiRatio,this._chartsGeometry=t.charts.map(((t,e)=>v(e,o,s,this._pixelRatio))),!g){let s=t.theme;void 0!==e.backgroundColor&&(s="black"===(0,n.rgbToBlackWhiteString)((0,n.parseRgb)(e.backgroundColor),150)?a.StdTheme.Dark:a.StdTheme.Light),this._logoTextColor=u.themes[s].getThemedColor("color-text-primary")}
this._headerDefaultTextColor=u.themes[t.theme].getThemedColor("color-text-primary")}async getImage(){const t=this._pixelRatio;let e=0,s=0,o=0;const n=this._headerItems();if(n.length>0){o=Math.ceil(1.4*this._options.fontSize*t)*n.length}s+=o;let a=0,h=0;for(const t of this._chartsGeometry)a=Math.max(a,t.x+t.width),h=Math.max(h,t.y+t.height);const u=s;e+=a,s+=h,e+=Math.round(10*t);const _=g?Math.round(10*t):Math.round(35*t),m=s;s+=_;const p=(0,l.createDisconnectedCanvas)(document,(0,i.size)({width:e,height:s}),1),f=(0,l.getContext2D)(p);f.font=(0,c.makeFont)(this._options.fontSize,this._options.font),f.textBaseline="top",f.fillStyle=this._options.backgroundColor,f.fillRect(0,0,e,s),n.length>0&&this._drawHeader(f,n,e,new r.Point(Math.round(10*t),Math.round(10*t)));for(let t=0;t<this._snapshotData.charts.length;++t){const e=this._snapshotData.charts[t],s=this._chartsGeometry[t];this._drawChart(e,s,f,new r.Point(0,u))}if(null!==this._logoTextColor){const e=await S(Math.round(20*t),Math.round(15*t),this._logoTextColor);f.fillStyle=this._logoTextColor,f.font=(0,c.makeFont)(13,d.CHART_FONT_FAMILY);const s=m+Math.round(_/2-e.height/2);b(f,Math.round(10*t),s,e,t)}return p}_drawChart(t,e,s,i){s.save(),s.translate(e.x+i.x,e.y+i.y);let o=0;for(const e of t.panes){let i=0;const n=e.leftAxis.canvas.width+Math.round(8*this._pixelRatio),a=o,h=o+Math.round(10*this._pixelRatio);e.leftAxis.contentWidth>0&&e.leftAxis.contentHeight>0&&(s.drawImage(e.leftAxis.canvas,i,o),i+=e.leftAxis.canvas.width),s.drawImage(e.canvas,i,o),i+=e.canvas.width,e.rightAxis.contentWidth>0&&e.rightAxis.contentHeight>0&&s.drawImage(e.rightAxis.canvas,i,o),"pane"===e.type&&(s.fillStyle=t.colors.text,this._drawLegend(e,s,new r.Point(n,h),a)),o+=e.canvas.height}if(void 0!==t.timeAxis&&0!==t.timeAxis.contentHeight){let e=0;t.timeAxis.lhsStub.contentWidth>0&&t.timeAxis.lhsStub.contentHeight>0&&(s.drawImage(t.timeAxis.lhsStub.canvas,e,o),e+=t.timeAxis.lhsStub.canvas.width),s.drawImage(t.timeAxis.canvas,e,o),e+=t.timeAxis.canvas.width,t.timeAxis.rhsStub.contentWidth>0&&t.timeAxis.rhsStub.contentHeight>0&&s.drawImage(t.timeAxis.rhsStub.canvas,e,o)}s.strokeStyle=this._options.borderColor,s.strokeRect(0,0,e.width,e.height),s.restore()}_headerItems(){const t=[];if(this._options.showHeaderPublishedBy&&this._snapshotData.publishedBy)for(const e of this._snapshotData.publishedBy)t.push([{text:e}]);if(this._options.showHeaderMainSymbol){const e=this._snapshotData.charts[0],s=`${e.meta?.symbol}, ${e.meta?.resolution}`;t.push(w(s,e.meta?.values??[]))}return t}_drawHeader(t,e,s,i){t.save(),t.fillStyle=this._headerDefaultTextColor;const o=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);e.forEach(((e,n)=>{x(t,this._pixelRatio,new r.Point(i.x,i.y+o*n),s,e,!0)})),t.restore()}_drawLegend(t,e,s,i){let n=!0;const a=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);let h=s.x,l=s.y;if(t.mainSeriesText&&l+a<i+t.canvas.height){const s=x(e,this._pixelRatio,new r.Point(h,l),t.contentWidth*this._pixelRatio,w(t.mainSeriesText,t.mainSeriesValues),!0)
;"horizontal"!==this._options.legendMode?l+=a:(h=(0,o.ensureNotNull)(s)+1.4*this._options.fontSize*this._pixelRatio,n=!1)}for(let o=0;o<t.studies.length;++o)if(l+a<i+t.canvas.height){const i=t.studies[o],d=t.studiesValues[o];let c=null;for(;null===c;)c=x(e,this._pixelRatio,new r.Point(h,l),t.contentWidth*this._pixelRatio,this._options.hideStudiesFromLegend?[]:w(i,C(d)),n),"horizontal"!==this._options.legendMode?l+=a:null===c?(n=!0,h=s.x,l+=a):(h=c+1.4*this._options.fontSize*this._pixelRatio,n=!1)}}}async function M(t,e){return new I(t,e).getImage()}class T{constructor(t,e){if(this._logoTextColor=null,this._widgetSnapshot=t,e=e||{},this._options={backgroundColor:u.themes[t.theme].getThemedColor("color-bg-primary"),borderColor:u.themes[t.theme].getThemedColor("color-border"),font:d.CHART_FONT_FAMILY,fontSize:12,showHeaderPublishedBy:!0,...e},this._pixelRatio=t.hidpiRatio,!g){let s=t.theme;void 0!==e.backgroundColor&&(s="black"===(0,n.rgbToBlackWhiteString)((0,n.parseRgb)(e.backgroundColor),150)?a.StdTheme.Dark:a.StdTheme.Light),this._logoTextColor=u.themes[s].getThemedColor("color-text-primary")}this._headerDefaultTextColor=u.themes[t.theme].getThemedColor("color-text-primary")}async getImage(){const t=this._pixelRatio,e=Math.round(10*t);let s=0,o=0,n=0;const a=this._headerItems();if(a.length>0){n=Math.ceil(1.4*this._options.fontSize*t)*a.length}o+=n;const h=o,u=this._widgetSnapshot.canvas.width,_=this._widgetSnapshot.canvas.height;s+=u+2*e,o+=_+e;const m=Math.round(35*t),g=o;o+=m;const p=(0,l.createDisconnectedCanvas)(document,(0,i.size)({width:s,height:o}),1),f=(0,l.getContext2D)(p);if(f.font=(0,c.makeFont)(this._options.fontSize,this._options.font),f.textBaseline="top",f.fillStyle=this._options.backgroundColor,f.fillRect(0,0,s,o),a.length>0&&this._drawHeader(f,a,s,new r.Point(e,e)),f.drawImage(this._widgetSnapshot.canvas,e,e+h),f.strokeStyle=this._options.borderColor,f.strokeRect(e,e+h,u,_),null!==this._logoTextColor){const s=await S(Math.round(20*t),Math.round(15*t),this._logoTextColor);f.fillStyle=this._logoTextColor,f.font=(0,c.makeFont)(13,d.CHART_FONT_FAMILY);b(f,e,g+Math.round(m/2-s.height/2),s,t)}return p}_headerItems(){const t=[];if(this._options.showHeaderPublishedBy&&this._widgetSnapshot.publishedBy)for(const e of this._widgetSnapshot.publishedBy)t.push([{text:e}]);return t}_drawHeader(t,e,s,i){t.save(),t.fillStyle=this._headerDefaultTextColor;const o=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);e.forEach(((e,n)=>{x(t,this._pixelRatio,new r.Point(i.x,i.y+o*n),s,e,!0)})),t.restore()}}async function A(t,e){return new T(t,e).getImage()}},319448:(t,e,s)=>{"use strict";s.d(e,{DateTimeFormatter:()=>n});var i=s(300484),o=s(553220);const r={dateFormat:"yyyy-MM-dd",withWeekday:!1,timeFormat:i.hourMinuteSecondFormat,dateTimeSeparator:" "};class n{constructor(t={}){const e=Object.assign({},r,t);this._dateFormatter=new o.DateFormatter(e.dateFormat,e.withWeekday),this._timeFormatter=new i.TimeFormatter(e.timeFormat),this._separator=e.dateTimeSeparator}format(t,e){const s=e?.dateTimeSeparator??this._separator
;return`${this._dateFormatter.format(t)}${s}${this._timeFormatter.format(t)}`}formatLocal(t,e){const s=e?.dateTimeSeparator??this._separator;return`${this._dateFormatter.formatLocal(t)}${s}${this._timeFormatter.formatLocal(t)}`}}},430719:(t,e,s)=>{"use strict";s.d(e,{DateTimeWithTzFormatter:()=>l});var i=s(601526),o=s(870045),r=s(300484),n=s(319448),a=s(553220);const h={dateFormat:"MMM dd",timeFormat:r.hourMinuteFormat};class l{constructor(t={}){const{dateFormat:e,timeFormat:s,timezone:i}={...h,...t};e&&s?this._dateFormatter=new n.DateTimeFormatter({dateFormat:e,timeFormat:s}):e?this._dateFormatter=new a.DateFormatter(e):s&&(this._dateFormatter=new r.TimeFormatter(s)),this._timezone=(0,o.get_timezone)(i??"Etc/UTC")}format(t){const e=1e3*t,s=(0,i.parseTzOffset)(this._timezone.name(),e).string;return void 0===this._dateFormatter?s:`${this._dateFormatter.format((0,o.utc_to_cal)(this._timezone,e))} ${s}`}setTimezone(t){this._timezone=(0,o.get_timezone)(t)}}},501372:(t,e,s)=>{"use strict";s.d(e,{SeriesDataSource:()=>x,initialRequestOptionsToNumBars:()=>S,parseJapaneseProjectionBars:()=>C});var i=s(650151),o=s(124829),r=s(882782),n=s(378975),a=s(368628),h=s(979351),l=s(124066),d=s(320771),c=s(338619),u=s(975179),_=s(61625);const m=(0,c.getLogger)("Chart.SeriesDataSource");var g;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",t[t.Active=3]="Active"}(g||(g={}));let p=1;let f=1;const v=300;function S(t){return t.startDate?t.endDate||t.count?t.endDate?["from_to",t.startDate,t.endDate]:["bar_count",t.startDate,(0,i.ensure)(t.count)]:["from_to",t.startDate]:t.count||v}function b(t){return(0,o.isString)(t.symbol)?t.symbol:t.symbol.symbol}function y(t,e){(0,o.isString)(t.symbol)?t.symbol=e:t.symbol.symbol=e}class x{constructor(t,e,s,i){this._extSymbol=null,this._lastResolvedSymbol="",this._createSeriesOverriddenParams=0,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new a.SeriesData,this._dataEvents=new d.SeriesDataEvents,this._status=g.Idle,this._turnaroundCounter=1,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,this._turnaroundPrefix=e,this._createSeriesParams=S(s??{count:v}),this._timeFrame=i||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged)}modifySeries(t,e,s=null,r=!1,a=null){r&&(m.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._extSymbol=null,this._resolution=null);const h=b(t),l=!this.symbolSameAsResolved(h);if(l&&(this._lastResolvedSymbol=""),this._extSymbol&&!l){y(t,b(this._extSymbol))}const d=this._extSymbol,c=this._resolution;if(this._extSymbol=t,this._resolution=e,null===this._instanceId)return void(this._timeFrame=s);const u=!(0,o.deepEquals)(d,t)[0];u&&y(this._extSymbol,h)
;const _=null===c||!n.Interval.isEqual(c,e);(u||_||null!==s)&&(this._timeFrame=null,(u||_)&&this._turnaroundCounter++,u&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),this._resolution,a,s,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(t){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,t,this._onMessage.bind(this))}requestMoreTickmarks(t){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,t,this._onMessage.bind(this))}setFutureTickmarksMode(t){null!==this._instanceId&&this._gateway.setFutureTickmarksMode(t)}isStarted(){return this._status!==g.Idle}isActive(){return this._status===g.Active}resolution(){return this._resolution}start(){this.isStarted()?m.logNormal("start: data source is already started, nothing to do"):((0,i.assert)(null!==this._extSymbol,"symbol must be set before start"),(0,i.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(g.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),this._symbolInstanceId=null,this._changeStatusTo(g.Idle)):m.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}setData(t){this._data=t}clearData(){this.isStarted()?this._enqueueUpdate((()=>this._clearDataImpl())):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._extSymbol}moveData(t){this._enqueueUpdate((()=>this._data.moveData(t)))}setInitialRequestOptions(t){this._createSeriesOverriddenParams=S(t)}symbolSameAsResolved(t){return null!==this._extSymbol&&(0,_.symbolSameAsResolved)(t,b(this._extSymbol),this._lastResolvedSymbol)}resolvedSymbol(){return null===this._extSymbol?null:b(this._extSymbol)}_resolveSymbol(){null!==this._extSymbol&&(this._symbolInstanceId=this._gateway.resolveSymbol("sds_sym_"+p++,(0,r.encodeExtendedSymbolOrGetSimpleSymbolString)(this._extSymbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(t){(0,i.assert)(this._status!==t,"Source and destination status should be distinct"),m.logNormal(`Status changed from ${g[this._status]} to ${g[t]}`),this._status=t}_createSeries(){(0,i.assert)(this._status!==g.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+f++,this._resolveSymbol();const t=this._createSeriesOverriddenParams||this._createSeriesParams;this._createSeriesOverriddenParams&&(this._createSeriesOverriddenParams=0),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),(0,i.ensureNotNull)(this._resolution),t,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(g.AwaitingFirstDataUpdate),
this._dataEvents.fireCreated(this._instanceId)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===g.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==g.Idle&&this._status!==g.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(g.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(t){this._enqueueUpdate((()=>this._onMessageImpl(t)))}async _onMessageImpl(t){switch(t.method){case"symbol_resolved":{const[e,s]=t.params;if(e!==this._symbolInstanceId){null!==this._symbolInstanceId&&m.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolResolved(s);break}case"symbol_error":if(t.params[0]!==this._symbolInstanceId){null!==this._symbolInstanceId&&m.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolError(t);break;case"series_timeframe":{const[e,s,i,o,r,n,a]=t.params;if(!this._checkTurnaround(e,s)){m.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesTimeFrame(i,o,r,n,a);break}case"series_error":{const[e,s]=t.params;if(!this._checkTurnaround(e,s)){m.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesError(t.params[2]);break}case"series_loading":{const[e,s]=t.params;if(!this._checkTurnaround(e,s))break;this._onSeriesLoading(t.time);break}case"series_completed":{const[e,s,i,o]=t.params;if(!this._checkTurnaround(e,i)){m.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${i})`);break}this._onSeriesCompleted(s,t.time,o);break}case"data_update":if(!this._checkTurnaround(t.params.customId,t.params.turnaround)){m.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t.params.customId} (${t.params.turnaround})`);break}await this._onDataUpdate(t.params.plots,t.params.nonseries,t.params.lastBar);break;case"clear_data":if(t.params.turnaround!==this.turnaround()){m.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${t.params.turnaround}`);break}this._clearDataImpl(),this._dataEvents.fireDataUpdated(void 0,!1,null,!1)}}_onSeriesError(t){let e,s;if("string"==typeof t)s={error:t},e=t;else if(s=t,t.ctx){const s={};Object.entries(t.ctx).forEach((([t,e])=>{s[t]=e.toString()})),e=t.error.format(s)}else e=t.error;if(e.startsWith("study_not_auth:")){const t=e.split(":",2)[1].split("@",2)[0];if(["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(t))this._dataEvents.fireChartTypeNotPermitted(t);else if("BarSetSpread"===t)this._dataEvents.fireIntradaySpreadNotPermitted();else if("BarSetRange"===t){const t=`${(0,i.ensureNotNull)(this._extSymbol).inputs.range}R`;this._dataEvents.fireCustomIntervalNotPermitted(t)}}else{
if(e.startsWith("unsupported"))return void this._dataEvents.fireUnsupportedResolutionRequested();"resolution_not_entitled"===e?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===e?this._dataEvents.fireCustomIntervalNotPermitted((0,i.ensureNotNull)(this._resolution)):"seconds_not_entitled"===e?this._dataEvents.fireSecondsIntervalNotPermitted():"ticks_not_entitled"===e&&this._dataEvents.fireTicksIntervalNotPermitted()}this._dataEvents.fireSeriesError(s)}_onSeriesTimeFrame(t,e,s,i,o){this._dataEvents.fireSeriesTimeFrame(t,e,s,i??!0,o)}_onSymbolError(t){if(t.params[1]===l.permissionDenied)switch(t.params[2]){case l.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(t.params[3]);break;case l.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(t.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(t.params[2])}else t.params[1]===l.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(t.params[1])}_onSymbolResolved(t){this._lastResolvedSymbol=(0,i.ensureNotNull)((0,u.extractSymbolNameFromSymbolInfo)(t,"")),this._dataEvents.fireSymbolResolved(t)}async _onDataUpdate(t,e,s){this._onDataUnpacked(t,s,await C(e))}_enqueueUpdate(t){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(t,t),this._ongoingDataUpdate}_onDataUnpacked(t,e,s){if(this._status===g.Idle)return;this._status===g.AwaitingFirstDataUpdate&&(this._changeStatusTo(g.Active),this._clearDataImpl());const i=this._data.bars().size(),o=this._data.bars().firstIndex(),r=this._data.mergeRegularBars(t);null!==s&&(this._data.nsBars().clear(),this._data.nsBars().merge(s.projectionPlots),this._data.lastProjectionPrice=s.lastPrice,null!==s.boxSize&&(this._data.boxSize=s.boxSize),this._data.reversalAmount=s.reversalAmount);const n=null===o,a=n||null!==r&&r.index<o;this._dataEvents.fireDataUpdated(e,a,r,n),i!==this._data.bars().size()&&null!==r&&this._dataEvents.fireBarReceived(r)}_onSeriesLoading(t){this._dataEvents.fireLoading(t)}_onSeriesCompleted(t,e,s){this._dataEvents.fireCompleted({updateMode:t,time:e,flags:s})}_checkTurnaround(t,e){return this._instanceId===t&&(void 0===e||e===this.turnaround())}}async function C(t){if(void 0===t)return{projectionPlots:[],boxSize:null};if(""===t.d||"nochange"===t.indexes)return null;const e=await(0,h.unpackNonSeriesData)(t.d);if(null===e||e.indexes_replace)return null;const s=t.indexes,{bars:i,price:o,boxSize:r,reversalAmount:n}=e.data;return{lastPrice:o,projectionPlots:(i||[]).map((t=>{let e;return"factor"in t?e=t.factor:"additionalPrice"in t&&(e=t.additionalPrice),{index:s[t.time],value:[0,t.open,t.high,t.low,t.close,t.volume,e]}})),reversalAmount:n,boxSize:r}}},607016:(t,e,s)=>{"use strict";s.d(e,{Session:()=>h});var i=s(650151),o=s(375397),r=s(942634),n=s(79342);const a=(0,s(338619).getLogger)("ChartApi.AbstractSession");class h{constructor(t,e,s){this._isConnected=new o.WatchedValue(!1),this._state=0,this._isConnectForbidden=!1,this._sessionId="",this._sessionIdChanged=new r.Delegate,
this._chartApi=t,this._sessionPrefix=e,this._shouldReconnectAfterCriticalError=s}destroy(){this._logNormal("Destroying session"),this._isConnected.unsubscribe(),this.disconnect(),this._sessionIdChanged.destroy(),delete this._chartApi,this._logNormal("Session has been destroyed")}isConnected(){return this._isConnected}sessionId(){return this._sessionId}onSessionIdChanged(){return this._sessionIdChanged}connect(){0===this._state&&((0,i.assert)(!this._isConnectForbidden,"Cannot call connect because it is forbidden at this moment"),this._setSessionId(`${this._sessionPrefix}_${(0,n.randomHash)()}`),this._logNormal("Connecting session - wait until transport stay connected"),this._state=1,this._chartApi.createSession(this._sessionId,this))}disconnect(){0!==this._state&&((0,i.assert)(""!==this._sessionId,"sessionId must not be invalid"),this._logNormal("Disconnecting session..."),this._forbidConnectWhile((()=>{this._chartApi.connected()&&this._sendRemoveSession(),this._processDestroyingOnServer()})))}onMessage(t){switch(t.method){case"connected":return void this._onChartApiConnected();case"disconnected":return void this._onChartApiDisconnected();case"critical_error":const e=String(t.params[0]),s=String(t.params[1]);return void this._onCriticalError(e,s)}this._onMessage(t)}serverTime(){return this._chartApi.serverTime()}_getChartApi(){return this._chartApi}_generateLogMessage(t){return`[${this._sessionId}] ${t}`}_onCriticalError(t,e){this._logError(`Critical error. Reason=${t}, info=${e}.`),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this._shouldReconnectAfterCriticalError?(this._logNormal("Reconnecting after critical error..."),this.connect()):this._logNormal("Reconnecting after critical error skipped")}_onChartApiConnected(){(0,i.assert)(1===this._state,"Session is not registered"),this._logNormal("Transport is connected. Creating session on the server"),this._sendCreateSession(),this._state=2,this._isConnected.setValue(!0)}_onChartApiDisconnected(){this._logNormal("Transport is disconnected. Reconnecting..."),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this.connect()}_setSessionId(t){const e=this._sessionId;this._logNormal(`Changing sessionId: old=${e}, new=${t}`),this._sessionId=t,this._sessionIdChanged.fire(t,e)}_logNormal(t){a.logNormal(this._generateLogMessage(t))}_logError(t){a.logError(this._generateLogMessage(t))}_processDestroyingOnServer(){this._state=0,this._isConnected.setValue(!1),this._chartApi.removeSession(this._sessionId),this._setSessionId("")}_forbidConnectWhile(t){this._isConnectForbidden=!0,t(),this._isConnectForbidden=!1}}},69184:(t,e,s)=>{"use strict";s.d(e,{getHourMinuteFormat:()=>o,getHourMinuteSecondFormat:()=>r,getTimeFormatForInterval:()=>n});var i=s(300484);function o(t){return"12-hours"===t?i.twelveHourMinuteFormat:i.hourMinuteFormat}function r(t){return"12-hours"===t?i.twelveHourMinuteSecondFormat:i.hourMinuteSecondFormat}function n(t,e){if(t.isRange())return function(t){
return"12-hours"===t?i.twelveHourMinuteNonZeroSecondFormat:i.hourMinuteNonZeroSecondFormat}(e);if(t.isTicks())return i.hourMinuteSecondMillisecFormat;return t.isSeconds()||t.isTicks()?r(e):o(e)}},776351:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 28" width="36" height="28"><path fill="currentColor" d="M14 22H7V11H0V4h14v18zM28 22h-8l7.5-18h8L28 22z"/><circle fill="currentColor" cx="20" cy="8" r="4"/></svg>'},287489:t=>{"use strict";t.exports=JSON.parse('{"4":["v",["h",0,2],["h",1,3]],"6":["v",["h",0,2,4],["h",1,3,5]],"8":["v",["h",0,2,4,6],["h",1,3,5,7]],"2h":["h",0,1],"2v":["v",0,1],"2-1":["v",["h",0,2],1],"3s":["h",0,["v",1,2]],"3h":["h",0,1,2],"3v":["v",0,1,2],"1-2":["v",0,["h",1,2]],"3r":["h",["v",0,1],2],"4h":["h",0,1,2,3],"4v":["v",0,1,2,3],"4s":["h",0,["v",1,2,3]],"4s-l":["h",["v",1,2,3],0],"5h":["h",0,1,2,3,4],"5v":["v",0,1,2,3,4],"6h":["h",0,1,2,3,4,5],"6v":["v",0,1,2,3,4,5],"7h":["h",0,1,2,3,4,5,6],"8h":["h",0,1,2,3,4,5,6,7],"8v":["v",0,1,2,3,4,5,6,7],"9h":["h",0,1,2,3,4,5,6,7,8],"9v":["v",0,1,2,3,4,5,6,7,8],"10h":["h",0,1,2,3,4,5,6,7,8,9],"10v":["v",0,1,2,3,4,5,6,7,8,9],"1-3":["v",0,["h",1,2,3]],"2-2":["v",["h",0,1],["v",2,3]],"2-2-l":["h",0,1,["v",2,3]],"2-3":["v",["h",0,1],["h",2,3,4]],"3-2":["v",["h",0,1,2],["h",3,4]],"1-4":["v",0,["h",1,2,3,4]],"2-4":["v",["h",0,1],["h",2,3,4,5]],"5s":["h",0,["v",1,2,3,4]],"6c":["v",["h",0,1],["h",2,3],["h",4,5]],"8c":["v",["h",0,1],["h",2,3],["h",4,5],["h",6,7]],"9s":["v",["h",0,1,2],["h",3,4,5],["h",6,7,8]],"10c5":["v",["h",0,2,4,6,8],["h",1,3,5,7,9]],"12c6":["v",["h",0,2,4,6,8,10],["h",1,3,5,7,9,11]],"12c4":["v",["h",0,4,8],["h",1,5,9],["h",2,6,10],["h",3,7,11]],"14c7":["v",["h",0,2,4,6,8,10,12],["h",1,3,5,7,9,11,13]],"16c8":["v",["h",0,2,4,6,8,10,12,14],["h",1,3,5,7,9,11,13,15]],"16c4":["v",["h",0,4,8,12],["h",1,5,9,13],["h",2,6,10,14],["h",3,7,11,15]],"s":0}')}}]);